% !TeX root = ../bachlor-arbeit.tex




\indent This combined model can easily be implemented as all the necessary modules are already there but it can not be trained. To understand why we need to go back to the concept of {\hyperref[eq:bg:back_prop]{Backpropagation}}.
During training the gradient of the cost function needs to propagate backwards through the network. To capture this mathematically we will identify the forward model in figure \ref{fig:al:combined} as the last layer $L$ in a combined network. Equation \eqref{eq:bg:back_prop} tells us we need to calculate
\begin{equation}
    \delta^L_j = \pdv{C}{a^L_j} \ \pdv{a^L_j}{z^L_j} \,.
\end{equation}

The first part $\partial C / \partial{a^L_j}$ is simple and only depends on the cost function. For example using \\
$C_\s{mse} = \sum_j \qty(a_j^L - y_j)^2$
the derivative is 
$\partial{C} / \partial{a^L_j} = 2 \qty(a_j^L - y_j)$.
However, the second part 
$\partial{a^L_j} / \partial{z^L_j}$,
the output of the last layer derived by the input to the last layer, is not easily accessible. Maybe not accessible at all if we consider the calls to the database and interpolation that happen during this step. The only way to train this combined tandem model is by replacing the forward model with something where we can access the gradient. This means training a second Neural Network to solve the forward problem.

\begin{figure}[H]
    \floatbox[{
    \capbeside
    \thisfloatsetup{capbesideposition={right,top}}}]{figure}[\FBwidth]
    {\caption{
        A part of the algorithm described in section \ref{sec:algorithm} can be understood as a tandem model 
        $I \rightarrow \mc D \rightarrow I'$.
        This combined model receives a target spectrum and outputs its best reproduction of that spectrum $I'$. The notation is the same as in figure \ref{fig:al:algo}.
    }
    \label{fig:al:combined}}
    {\includegraphics[width=0.6\textwidth]{al_combined}}
\end{figure}

\comment{
\begin{figure}[H]
    \centering
    \includegraphics[width=.6\linewidth]{al_combined}
    \caption{A part of the algorithm described in section \ref{sec:algorithm} can be understood as a tandem model 
    $I \rightarrow \mc D \rightarrow I'$.
    This combined model receives a target spectrum and outputs its best reproduction of that spectrum $I'$. The notation is the same as in figure \ref{fig:al:algo}.}
    \label{fig:al:combined}
\end{figure}
}
